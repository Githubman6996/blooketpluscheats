javascript:(async()=>{let e=0,r=Date.now(),t=Date.now();const n=[...document.querySelectorAll("link")].filter((e=>e.href.includes("colyseus-")))[0].href,o=await import(n);let a=o.a().Room.prototype.send;o.a().Room.prototype.send=function(n){if(window.room=this,e<1&&(room.state.map.cells.forEach((e=>e.listen("powerup",(()=>{d.forEach((e=>e.visible=!1)),f.forEach((e=>e[1].clear())),f=[],d=[],M().forEach((e=>{v(e),E(e)}))})))),room.onMessage("showQuestion",(e=>{if(!e)return;S=e;let r=P.get(e.number);r&&s.autoAnswer&&room.send("playerAnswerQuestion",{answer:r[0]})})),room.onMessage("answerResult",(e=>{e.correctAnswers&&P.set(S.number,e.correctAnswers),room.send("playerAnswerNext",null),l.respawning=!1})),room.onMessage("playerPosUpdate",(e=>{if(s.autoShoot){let a=Array.from(room.state.players).filter((e=>e[1].sessionId)),i=a.filter((e=>e[1].sessionId==room.sessionId))[0],l=Array.from(room.state.targets).filter((e=>!e[1].isHit)).sort(((e,r)=>n(i,e)-n(i,r)));function n(e,r){return Math.hypot(e[1].x-r[1].x,e[1].y-r[1].y)}function o(e,r){return Math.atan2(e[1].y-r[1].y,e[1].x-r[1].x)}if(a=a.filter((e=>e[1]!==i[1])).filter((e=>!e[1].invulnerable)).sort(((e,r)=>n(i,e)-n(i,r))),a=a.concat(l),a=a.filter((e=>!L(new Phaser.Geom.Line(i[1].x,i[1].y,e[1].x,e[1].y)))),a.length<1)return;let c=o(a[0],i);Date.now()-t>50&&(room.send("playerMouseUpdate",{mouseAngle:c}),t=Date.now()),Date.now()-r>50&&(room.send("playerMouseClick",null),r=Date.now())}})),e=1),!s.freeCam||"playerMoveInput"!=n)return a.apply(this,arguments)};let s={renderPlayers:!0,renderTargets:!0,renderPowerups:!0,scrollZoom:!0,scrollSensitivity:70,freeCamSensitivity:12,spectatingPlayer:null,autoShoot:!1,autoAnswer:!0},i=Object.values(document.querySelector("#phaser-laserGame"))[0].return.updateQueue.lastEffect.deps[1].current.game.scene.scenes[1],l=i.localPlayer;function c(){return[...i.players].map((e=>e[1])).filter((e=>e.player.sessionId))}let p=[],u=[],y=[],h=[],f=[],d=[];function m(e){let r=i.add.graphics();r.lineStyle(2,65280),r.strokeRect(-40,-40,80,84),y.push(r),e.container.add(r)}function w(e){let r=i.add.graphics(),t=new Phaser.Geom.Line(l.container.x,l.container.y,e.container.x,e.container.y);const n=L(t);r.lineStyle(2,n?26112:65280),r.setDepth(99999),s.renderPlayers&&r.strokeLineShape(t),p.push([e,r,t])}function g(){y.forEach((e=>e.visible=s.renderPlayers)),p.forEach((e=>{let r=e[1],t=e[2];t.setTo(l.container.x,l.container.y,e[0].container.x,e[0].container.y);const n=L(t);r.clear(),r.lineStyle(2,n?26112:65280),s.renderPlayers&&r.strokeLineShape(t)}))}document.addEventListener("keydown",(e=>{switch(e.key){case"f":room.send("playerMoveInput",{moving:!1,inputX:0,inputY:0}),s.freeCam=!s.freeCam,l.applyMovement(0,0);break;case"g":s.autoShoot=!s.autoShoot;break;case"1":s.renderPlayers=!s.renderPlayers,g();break;case"2":s.renderTargets=!s.renderTargets,x();break;case"3":s.renderPowerups=!s.renderPowerups,k()}}));let P=new Map,S={};function x(){h.forEach((e=>e.visible=s.renderTargets)),u.forEach((e=>{let r=e[1],t=e[2];t.setTo(l.container.x,l.container.y,e[0].container.x,e[0].container.y);const n=L(t);r.clear(),r.lineStyle(2,n?6684672:16711680),s.renderTargets&&r.strokeLineShape(t)}))}function v(e){let r=i.add.graphics(),t=e.powerupSprite;r.lineStyle(2,255),r.strokeRect(t.x-t.width/2,t.y-t.height/2,t.width,t.height),d.push(r)}function E(e){let r=i.add.graphics(),t=new Phaser.Geom.Line(l.container.x,l.container.y,e.powerupSprite.x,e.powerupSprite.y);const n=L(t);r.lineStyle(2,n?102:255),r.setDepth(99999),s.renderPowerups&&r.strokeLineShape(t),f.push([e,r,t])}function k(){d.forEach((e=>e.visible=s.renderPowerups)),f.forEach((e=>{let r=e[1],t=e[2];t.setTo(l.container.x,l.container.y,e[0].powerupSprite.x,e[0].powerupSprite.y);const n=L(t);r.clear(),r.lineStyle(2,n?102:255),s.renderPowerups&&r.strokeLineShape(t)}))}function M(){return[...i.mapCells].map((e=>e[1])).filter((e=>e.powerupSprite)).filter((e=>e.cell.powerup))}window.exportAnswers=()=>btoa(JSON.stringify([...P])),window.importAnswers=e=>{try{P.clear(),JSON.parse(atob(e)).forEach((e=>P.set(e[0],e[1])))}catch(e){}},i.localPlayer.applyMovement2||(i.localPlayer.applyMovement2=i.localPlayer.applyMovement,i.localPlayer.applyMovement=function(e,r){if(i.cameras.main._follow=s.freeCam?null:s.spectatingPlayer?s.spectatingPlayer.container:l.container,!s.freeCam)return i.localPlayer.applyMovement2.apply(this,arguments);!function(e,r){i.cameras.main.scrollX+=e*s.freeCamSensitivity,i.cameras.main.scrollY+=r*s.freeCamSensitivity}(e,r)});let b=[...i.mapCells].map((e=>e[1])).filter((e=>e.cell.isWall)).map((e=>({x:100*e.cell.x,y:100*e.cell.y,width:e.cell.width,height:e.cell.height})));function A(e,r){return Phaser.Geom.Intersects.LineToRectangle(e,new Phaser.Geom.Rectangle(r.x,r.y,r.width,r.height))}function L(e){for(let r=0;r<b.length;r++)if(A(e,b[r]))return 1;return 0}let C=c().length;function T(){s.renderPlayers&&g(),s.renderTargets&&x(),s.renderPowerups&&k(),i.input._events.wheel||i.input.on("wheel",(e=>{s.scrollZoom&&(i.cameras.main.zoom-=e.deltaY/2e5*s.scrollSensitivity)})),C!==c().length&&(p.forEach((e=>e[1].clear())),p=[],y=[],c().forEach((e=>{m(e),w(e),D(e)}))),C=c().length}function D(e){e.container.setPosition2||(e.container.setPosition2=e.container.setPosition,e.container.setPosition=function(){T(),e.container.setPosition2.apply(this,arguments),T()})}c().forEach((e=>{m(e),w(e),D(e)})),[...i.targets].map((e=>e[1])).forEach((e=>{!function(e){let r=i.add.graphics();r.lineStyle(2,16711680),r.strokeRect(-40,-40,80,84),h.push(r),e.container.add(r)}(e),function(e){let r=i.add.graphics(),t=new Phaser.Geom.Line(l.container.x,l.container.y,e.container.x,e.container.y);const n=L(t);r.lineStyle(2,n?6684672:16711680),r.setDepth(99999),s.renderTargets&&r.strokeLineShape(t),u.push([e,r,t])}(e)})),M().forEach((e=>{v(e),E(e)})),D(l)})();
