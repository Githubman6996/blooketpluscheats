javascript:(async()=>{let e=0,r=Date.now();const t=[...document.querySelectorAll("link")].filter((e=>e.href.includes("colyseus-")))[0].href,n=await import(t);let o=n.a().Room.prototype.send;n.a().Room.prototype.send=function(t){if(window.room=this,e<1&&(room.state.map.cells.forEach((e=>e.listen("powerup",(()=>{f.forEach((e=>e.visible=!1)),h.forEach((e=>e[1].clear())),h=[],f=[],x().forEach((e=>{P(e),S(e)}))})))),room.onMessage("showQuestion",(e=>{if(!e)return;g=e;let r=w.get(e.number);r&&a.autoAnswer&&room.send("playerAnswerQuestion",{answer:r[0]})})),room.onMessage("answerResult",(e=>{e.correctAnswers&&w.set(g.number,e.correctAnswers),room.send("playerAnswerNext",null),i.respawning=!1})),room.onMessage("playerPosUpdate",(e=>{if(a.autoShoot){let o=Array.from(room.state.players).filter((e=>e[1].sessionId)),s=o.filter((e=>e[1].sessionId==room.sessionId))[0],i=Array.from(room.state.targets).filter((e=>!e[1].isHit)).sort(((e,r)=>t(s,e)-t(s,r)));function t(e,r){return Math.hypot(e[1].x-r[1].x,e[1].y-r[1].y)}function n(e,r){return Math.atan2(e[1].y-r[1].y,e[1].x-r[1].x)}if(o=o.filter((e=>e[1]!==s[1])).filter((e=>!e[1].invulnerable)).sort(((e,r)=>t(s,e)-t(s,r))),o=o.concat(i),o=o.filter((e=>!E(new Phaser.Geom.Line(s[1].x,s[1].y,e[1].x,e[1].y)))),o.length<1)return;let l=n(o[0],s);Date.now()-r>50&&(room.send("playerMouseUpdate",{mouseAngle:l}),room.send("playerMouseClick",null),r=Date.now())}})),e=1),!a.freeCam||"playerMoveInput"!=t)return o.apply(this,arguments)};let a={renderPlayers:!0,renderTargets:!0,renderPowerups:!0,scrollZoom:!0,scrollSensitivity:70,freeCamSensitivity:12,spectatingPlayer:null,autoShoot:!1,autoAnswer:!0},s=Object.values(document.querySelector("#phaser-laserGame"))[0].return.updateQueue.lastEffect.deps[1].current.game.scene.scenes[1],i=s.localPlayer;function l(){return[...s.players].map((e=>e[1])).filter((e=>e.player.sessionId))}let c=[],p=[],u=[],y=[],h=[],f=[];function m(e){let r=s.add.graphics();r.lineStyle(2,65280),r.strokeRect(-40,-40,80,84),u.push(r),e.container.add(r)}function d(e){let r=s.add.graphics(),t=new Phaser.Geom.Line(i.container.x,i.container.y,e.container.x,e.container.y);const n=E(t);r.lineStyle(2,n?26112:65280),r.setDepth(99999),a.renderPlayers&&r.strokeLineShape(t),c.push([e,r,t])}document.addEventListener("keydown",(e=>{switch(e.key){case"f":room.send("playerMoveInput",{moving:!1,inputX:0,inputY:0}),a.freeCam=!a.freeCam,i.applyMovement(0,0);break;case"g":a.autoShoot=!a.autoShoot;break;case"1":a.renderPlayers=!a.renderPlayers;break;case"2":a.renderTargets=!a.renderTargets,b();break;case"3":a.renderPowerups=!a.renderPowerups,b()}}));let w=new Map,g={};function P(e){let r=s.add.graphics(),t=e.powerupSprite;r.lineStyle(2,255),r.strokeRect(t.x-t.width/2,t.y-t.height/2,t.width,t.height),f.push(r)}function S(e){let r=s.add.graphics(),t=new Phaser.Geom.Line(i.container.x,i.container.y,e.powerupSprite.x,e.powerupSprite.y);const n=E(t);r.lineStyle(2,n?102:255),r.setDepth(99999),a.renderPowerups&&r.strokeLineShape(t),h.push([e,r,t])}function x(){return[...s.mapCells].map((e=>e[1])).filter((e=>e.powerupSprite)).filter((e=>e.cell.powerup))}s.localPlayer.applyMovement2||(s.localPlayer.applyMovement2=s.localPlayer.applyMovement,s.localPlayer.applyMovement=function(e,r){if(s.cameras.main._follow=a.freeCam?null:a.spectatingPlayer?a.spectatingPlayer.container:i.container,!a.freeCam)return s.localPlayer.applyMovement2.apply(this,arguments);!function(e,r){s.cameras.main.scrollX+=e*a.freeCamSensitivity,s.cameras.main.scrollY+=r*a.freeCamSensitivity}(e,r)});let v=[...s.mapCells].map((e=>e[1])).filter((e=>e.cell.isWall)).map((e=>({x:100*e.cell.x,y:100*e.cell.y,width:e.cell.width,height:e.cell.height})));function k(e,r){return Phaser.Geom.Intersects.LineToRectangle(e,new Phaser.Geom.Rectangle(r.x,r.y,r.width,r.height))}function E(e){for(let r=0;r<v.length;r++)if(k(e,v[r]))return 1;return 0}let M=l().length;function b(){u.forEach((e=>e.visible=a.renderPlayers)),c.forEach((e=>{let r=e[1],t=e[2];t.setTo(i.container.x,i.container.y,e[0].container.x,e[0].container.y);const n=E(t);r.clear(),r.lineStyle(2,n?26112:65280),a.renderPlayers&&r.strokeLineShape(t)})),y.forEach((e=>e.visible=a.renderTargets)),p.forEach((e=>{let r=e[1],t=e[2];t.setTo(i.container.x,i.container.y,e[0].container.x,e[0].container.y);const n=E(t);r.clear(),r.lineStyle(2,n?6684672:16711680),a.renderTargets&&r.strokeLineShape(t)})),f.forEach((e=>e.visible=a.renderPowerups)),h.forEach((e=>{let r=e[1],t=e[2];t.setTo(i.container.x,i.container.y,e[0].powerupSprite.x,e[0].powerupSprite.y);const n=E(t);r.clear(),r.lineStyle(2,n?102:255),a.renderPowerups&&r.strokeLineShape(t)})),s.input._events.wheel||s.input.on("wheel",(e=>{a.scrollZoom&&(s.cameras.main.zoom-=e.deltaY/2e5*a.scrollSensitivity)})),M!==l().length&&(c.forEach((e=>e[1].clear())),c=[],u=[],l().forEach((e=>{m(e),d(e),L(e)}))),M=l().length}function L(e){e.container.setPosition2||(e.container.setPosition2=e.container.setPosition,e.container.setPosition=function(){b(),e.container.setPosition2.apply(this,arguments),b()})}l().forEach((e=>{m(e),d(e),L(e)})),[...s.targets].map((e=>e[1])).forEach((e=>{!function(e){let r=s.add.graphics();r.lineStyle(2,16711680),r.strokeRect(-40,-40,80,84),y.push(r),e.container.add(r)}(e),function(e){let r=s.add.graphics(),t=new Phaser.Geom.Line(i.container.x,i.container.y,e.container.x,e.container.y);const n=E(t);r.lineStyle(2,n?6684672:16711680),r.setDepth(99999),a.renderTargets&&r.strokeLineShape(t),p.push([e,r,t])}(e)})),x().forEach((e=>{P(e),S(e)})),L(i)})();
