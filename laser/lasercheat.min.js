javascript:(async()=>{let e=0,r=Date.now(),t=Date.now(),n={autoAim:{scaleFactor:2.5,predictMovement:!1},renderPlayers:!0,renderTargets:!0,renderPowerups:!0,scrollZoom:!0,scrollSensitivity:70,freeCamSensitivity:12,spectatingPlayer:null,autoShoot:!1,autoAnswer:!0},o=Object.values(document.querySelector("#phaser-laserGame"))[0].return.updateQueue.lastEffect.deps[1].current.game.scene.scenes[1],a=o.localPlayer;const i=[...document.querySelectorAll("link")].filter((e=>e.href.includes("colyseus-")))[0].href,l=await import(i);let s=l.a().Room.prototype.send;function c(e,r){return Math.atan2(e[1].y-r[1].y,e[1].x-r[1].x)}function p(e,r){let t=e[0],n=0;for(let i=0;i<e.length;i++){let l=(o=e[i],a=r,Math.hypot(o[1].x-a[1].x,o[1].y-a[1].y));l<t&&(n=i,t=l)}var o,a;return e[n]}function u(){return[...o.players].map((e=>e[1])).filter((e=>e.player.sessionId))}window.room=void 0,l.a().Room.prototype.send=function(o){if(window.room=this,e<1&&(room.state.map.cells.forEach((e=>e.listen("powerup",(()=>{w.forEach((e=>e.visible=!1)),d.forEach((e=>e[1].clear())),d=[],w=[],b().forEach((e=>{E(e),k(e)}))})))),room.onMessage("showQuestion",(e=>{if(!e)return;v=e;let r=x.get(e.number);r&&n.autoAnswer&&room.send("playerAnswerQuestion",{answer:r[0]})})),room.onMessage("answerResult",(e=>{e.correctAnswers&&x.set(v.number,e.correctAnswers),room.send("playerAnswerNext",null),a.respawning=!1})),room.onMessage("playerPosUpdate",(()=>{if(n.autoShoot){let e=[null,a.player],o=0,i=Array.from(room.state.players).filter((r=>r[1].sessionId&&r[1]!==e[1]&&!r[1].invulnerable&&!T(new Phaser.Geom.Line(e[1].x,e[1].y,r[1].x,r[1].y))));if(i.length<1){let r=Array.from(room.state.targets).filter((r=>!r[1].isHit&&!T(new Phaser.Geom.Line(e[1].x,e[1].y,r[1].x,r[1].y))));if(r.length<1)return;o=c(p(r,e),e)}else{let r=room.state.players.get(p(i,e)[1].name);if(n.autoAim.predictMovement){let t={x:r.x,y:r.y};t={x:r.x+r.velocity.x*n.autoAim.scaleFactor,y:r.y+r.velocity.y*n.autoAim.scaleFactor},o=c([null,t],e)}else o=c(p(i,e),e)}Date.now()-t>10&&(room.send("playerMouseUpdate",{mouseAngle:o}),t=Date.now()),Date.now()-r>50&&(room.send("playerMouseUpdate",{mouseAngle:o}),room.send("playerMouseClick",null),r=Date.now())}})),e=1),!n.freeCam||"playerMoveInput"!=o)return s.apply(this,arguments)};let y=[],h=[],m=[],f=[],d=[],w=[];function g(e){let r=o.add.graphics();r.lineStyle(2,65280),r.strokeRect(-40,-40,80,84),m.push(r),e.container.add(r)}function P(e){let r=o.add.graphics(),t=new Phaser.Geom.Line(a.container.x,a.container.y,e.container.x,e.container.y);const i=T(t);r.lineStyle(2,i?26112:65280),r.setDepth(99999),n.renderPlayers&&r.strokeLineShape(t),y.push([e,r,t])}function S(){m.forEach((e=>e.visible=n.renderPlayers)),y.forEach((e=>{let r=e[1],t=e[2];if(t.setTo(a.container.x,a.container.y,e[0].container.x,e[0].container.y),r.clear(),n.renderPlayers){const e=T(t);r.lineStyle(2,e?26112:65280),r.strokeLineShape(t)}}))}document.addEventListener("keydown",(e=>{switch(e.key){case"f":room.send("playerMoveInput",{moving:!1,inputX:0,inputY:0}),n.freeCam=!n.freeCam,a.applyMovement(0,0);break;case"g":n.autoShoot=!n.autoShoot;break;case"1":n.renderPlayers=!n.renderPlayers,S();break;case"2":n.renderTargets=!n.renderTargets,M();break;case"3":n.renderPowerups=!n.renderPowerups,A()}}));let x=new Map,v={};function M(){f.forEach((e=>e.visible=n.renderTargets)),h.forEach((e=>{let r=e[1],t=e[2];if(t.setTo(a.container.x,a.container.y,e[0].container.x,e[0].container.y),r.clear(),n.renderTargets){const e=T(t);r.lineStyle(2,e?6684672:16711680),r.strokeLineShape(t)}}))}function E(e){let r=o.add.graphics(),t=e.powerupSprite;r.lineStyle(2,255),r.strokeRect(t.x-t.width/2,t.y-t.height/2,t.width,t.height),w.push(r)}function k(e){let r=o.add.graphics(),t=new Phaser.Geom.Line(a.container.x,a.container.y,e.powerupSprite.x,e.powerupSprite.y);const i=T(t);r.lineStyle(2,i?102:255),r.setDepth(99999),n.renderPowerups&&r.strokeLineShape(t),d.push([e,r,t])}function A(){w.forEach((e=>e.visible=n.renderPowerups)),d.forEach((e=>{let r=e[1],t=e[2];if(t.setTo(a.container.x,a.container.y,e[0].powerupSprite.x,e[0].powerupSprite.y),r.clear(),n.renderPowerups){const e=T(t);r.lineStyle(2,e?102:255),r.strokeLineShape(t)}}))}function b(){return[...o.mapCells].map((e=>e[1])).filter((e=>e.powerupSprite)).filter((e=>e.cell.powerup))}window.exportAnswers=()=>btoa(JSON.stringify([...x])),window.importAnswers=e=>{try{x.clear(),JSON.parse(atob(e)).forEach((e=>x.set(e[0],e[1])))}catch(e){}},o.localPlayer.applyMovement2||(o.localPlayer.applyMovement2=o.localPlayer.applyMovement,o.localPlayer.applyMovement=function(e,r){if(o.cameras.main._follow=n.freeCam?null:n.spectatingPlayer?n.spectatingPlayer.container:a.container,!n.freeCam)return o.localPlayer.applyMovement2.apply(this,arguments);!function(e,r){o.cameras.main.scrollX+=e*n.freeCamSensitivity,o.cameras.main.scrollY+=r*n.freeCamSensitivity}(e,r)});let L=[...o.mapCells].map((e=>e[1])).filter((e=>e.cell.isWall)).map((e=>({x:100*e.cell.x,y:100*e.cell.y,width:e.cell.width,height:e.cell.height})));function C(e,r){return Phaser.Geom.Intersects.LineToRectangle(e,new Phaser.Geom.Rectangle(r.x,r.y,r.width,r.height))}function T(e){for(let r=0;r<L.length;r++)if(C(e,L[r]))return 1;return 0}Date.now();let D=u().length;function G(){n.renderPlayers&&S(),n.renderTargets&&M(),n.renderPowerups&&A(),o.input._events.wheel||o.input.on("wheel",(e=>{n.scrollZoom&&(o.cameras.main.zoom-=e.deltaY/2e5*n.scrollSensitivity)})),D!==u().length&&(y.forEach((e=>e[1].clear())),y=[],m=[],u().forEach((e=>{g(e),P(e),R(e)}))),D=u().length}function R(e){e.container.setPosition2||(e.container.setPosition2=e.container.setPosition,e.container.setPosition=function(){G(),e.container.setPosition2.apply(this,arguments),G()},console.log(window.room))}u().forEach((e=>{g(e),P(e),R(e)})),[...o.targets].map((e=>e[1])).forEach((e=>{!function(e){let r=o.add.graphics();r.lineStyle(2,16711680),r.strokeRect(-40,-40,80,84),f.push(r),e.container.add(r)}(e),function(e){let r=o.add.graphics(),t=new Phaser.Geom.Line(a.container.x,a.container.y,e.container.x,e.container.y);const i=T(t);r.lineStyle(2,i?6684672:16711680),r.setDepth(99999),n.renderTargets&&r.strokeLineShape(t),h.push([e,r,t])}(e)})),b().forEach((e=>{E(e),k(e)})),R(a)})();
