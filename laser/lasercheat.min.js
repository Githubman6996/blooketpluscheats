javascript:(async()=>{let e=0,t=Date.now(),r=Date.now(),n={autoAim:{scaleFactor:2.5,predictMovement:!1},renderPlayers:!0,renderTargets:!0,renderPowerups:!0,scrollZoom:!0,scrollSensitivity:70,freeCamSensitivity:12,spectatingPlayer:null,autoShoot:!1,autoAnswer:!0},o=Object.values(document.querySelector("#phaser-laserGame"))[0].return.updateQueue.lastEffect.deps[1].current.game.scene.scenes[1],a=o.localPlayer;const l=[...document.querySelectorAll("link")].filter((e=>e.href.includes("colyseus-")))[0].href,i=await import(l);let s=i.a().Room.prototype.send;function c(e,t){return Math.atan2(e[1].y-t[1].y,e[1].x-t[1].x)}function p(e,t){let r=e[0],n=0;for(let l=0;l<e.length;l++){let i=(o=e[l],a=t,Math.hypot(o[1].x-a[1].x,o[1].y-a[1].y));i<r&&(n=l,r=i)}var o,a;return e[n]}function u(){return[...o.players].map((e=>e[1])).filter((e=>e.player.sessionId))}window.room=void 0,i.a().Room.prototype.send=function(o){if(window.room=this,e<1&&(room.state.map.cells.forEach((e=>e.listen("powerup",(()=>{w.forEach((e=>e.visible=!1)),d.forEach((e=>e[1].clear())),d=[],w=[],b().forEach((e=>{E(e),k(e)}))})))),room.onMessage("showQuestion",(e=>{if(!e)return;v=e;let t=x.get(e.number);t&&n.autoAnswer&&room.send("playerAnswerQuestion",{answer:t[0]})})),room.onMessage("answerResult",(e=>{e.correctAnswers&&x.set(v.number,e.correctAnswers),room.send("playerAnswerNext",null),a.respawning=!1})),room.onMessage("playerPosUpdate",(()=>{if(n.autoShoot){let e=[null,a.player],o=0,l=Array.from(room.state.players).filter((t=>t[1].sessionId&&t[1]!==e[1]&&!t[1].invulnerable&&!T(new Phaser.Geom.Line(e[1].x,e[1].y,t[1].x,t[1].y))));if(l.length<1){let t=Array.from(room.state.targets).filter((t=>!t[1].isHit&&!T(new Phaser.Geom.Line(e[1].x,e[1].y,t[1].x,t[1].y))));if(t.length<1)return;o=c(p(t,e),e)}else{let t=room.state.players.get(p(l,e)[1].name);if(n.autoAim.predictMovement){let r={x:t.x,y:t.y};r={x:t.x+t.velocity.x*n.autoAim.scaleFactor,y:t.y+t.velocity.y*n.autoAim.scaleFactor},o=c([null,r],e)}else o=c(p(l,e),e)}s.apply(room,["playerMouseUpdate",{mouseAngle:o}]),r=Date.now(),Date.now()-t>50&&(room.send("playerMouseUpdate",{mouseAngle:o}),room.send("playerMouseClick",null),t=Date.now())}})),e=1),!(n.autoShoot&&"playerMouseUpdate"==o||n.freeCam&&"playerMoveInput"==o))return s.apply(this,arguments)};let y=[],h=[],m=[],f=[],d=[],w=[];function g(e){let t=o.add.graphics();t.lineStyle(2,65280),t.strokeRect(-40,-40,80,84),m.push(t),e.container.add(t)}function P(e){let t=o.add.graphics(),r=new Phaser.Geom.Line(a.container.x,a.container.y,e.container.x,e.container.y);const l=T(r);t.lineStyle(2,l?26112:65280),t.setDepth(99999),n.renderPlayers&&t.strokeLineShape(r),y.push([e,t,r])}function S(){m.forEach((e=>e.visible=n.renderPlayers)),y.forEach((e=>{let t=e[1],r=e[2];if(r.setTo(a.container.x,a.container.y,e[0].container.x,e[0].container.y),t.clear(),n.renderPlayers){const e=T(r);t.lineStyle(2,e?26112:65280),t.strokeLineShape(r)}}))}document.addEventListener("keydown",(e=>{switch(e.key){case"f":room.send("playerMoveInput",{moving:!1,inputX:0,inputY:0}),n.freeCam=!n.freeCam,a.applyMovement(0,0);break;case"g":n.autoShoot=!n.autoShoot;break;case"1":n.renderPlayers=!n.renderPlayers,S();break;case"2":n.renderTargets=!n.renderTargets,M();break;case"3":n.renderPowerups=!n.renderPowerups,A()}}));let x=new Map,v={};function M(){f.forEach((e=>e.visible=n.renderTargets)),h.forEach((e=>{let t=e[1],r=e[2];if(r.setTo(a.container.x,a.container.y,e[0].container.x,e[0].container.y),t.clear(),n.renderTargets){const e=T(r);t.lineStyle(2,e?6684672:16711680),t.strokeLineShape(r)}}))}function E(e){let t=o.add.graphics(),r=e.powerupSprite;t.lineStyle(2,255),t.strokeRect(r.x-r.width/2,r.y-r.height/2,r.width,r.height),w.push(t)}function k(e){let t=o.add.graphics(),r=new Phaser.Geom.Line(a.container.x,a.container.y,e.powerupSprite.x,e.powerupSprite.y);const l=T(r);t.lineStyle(2,l?102:255),t.setDepth(99999),n.renderPowerups&&t.strokeLineShape(r),d.push([e,t,r])}function A(){w.forEach((e=>e.visible=n.renderPowerups)),d.forEach((e=>{let t=e[1],r=e[2];if(r.setTo(a.container.x,a.container.y,e[0].powerupSprite.x,e[0].powerupSprite.y),t.clear(),n.renderPowerups){const e=T(r);t.lineStyle(2,e?102:255),t.strokeLineShape(r)}}))}function b(){return[...o.mapCells].map((e=>e[1])).filter((e=>e.powerupSprite)).filter((e=>e.cell.powerup))}window.exportAnswers=()=>btoa(JSON.stringify([...x])),window.importAnswers=e=>{try{x.clear(),JSON.parse(atob(e)).forEach((e=>x.set(e[0],e[1])))}catch(e){}},o.localPlayer.applyMovement2||(o.localPlayer.applyMovement2=o.localPlayer.applyMovement,o.localPlayer.applyMovement=function(e,t){if(o.cameras.main._follow=n.freeCam?null:n.spectatingPlayer?n.spectatingPlayer.container:a.container,!n.freeCam)return o.localPlayer.applyMovement2.apply(this,arguments);!function(e,t){o.cameras.main.scrollX+=e*n.freeCamSensitivity,o.cameras.main.scrollY+=t*n.freeCamSensitivity}(e,t)});let L=[...o.mapCells].map((e=>e[1])).filter((e=>e.cell.isWall)).map((e=>({x:100*e.cell.x,y:100*e.cell.y,width:e.cell.width,height:e.cell.height})));function C(e,t){return Phaser.Geom.Intersects.LineToRectangle(e,new Phaser.Geom.Rectangle(t.x,t.y,t.width,t.height))}function T(e){for(let t=0;t<L.length;t++)if(C(e,L[t]))return 1;return 0}Date.now();let D=u().length;function G(){n.renderPlayers&&S(),n.renderTargets&&M(),n.renderPowerups&&A(),o.input._events.wheel||o.input.on("wheel",(e=>{n.scrollZoom&&(o.cameras.main.zoom-=e.deltaY/2e5*n.scrollSensitivity)})),D!==u().length&&(y.forEach((e=>e[1].clear())),y=[],m=[],u().forEach((e=>{g(e),P(e),R(e)}))),D=u().length}function R(e){e.container.setPosition2||(e.container.setPosition2=e.container.setPosition,e.container.setPosition=function(){G(),e.container.setPosition2.apply(this,arguments),G()},console.log(window.room))}u().forEach((e=>{g(e),P(e),R(e)})),[...o.targets].map((e=>e[1])).forEach((e=>{!function(e){let t=o.add.graphics();t.lineStyle(2,16711680),t.strokeRect(-40,-40,80,84),f.push(t),e.container.add(t)}(e),function(e){let t=o.add.graphics(),r=new Phaser.Geom.Line(a.container.x,a.container.y,e.container.x,e.container.y);const l=T(r);t.lineStyle(2,l?6684672:16711680),t.setDepth(99999),n.renderTargets&&t.strokeLineShape(r),h.push([e,t,r])}(e)})),b().forEach((e=>{E(e),k(e)})),R(a)})();
